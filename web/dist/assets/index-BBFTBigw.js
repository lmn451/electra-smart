var un=Object.defineProperty;var an=(e,t,n)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var dt=(e,t,n)=>an(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function X(){}function xt(e){return e()}function Vt(){return Object.create(null)}function W(e){e.forEach(xt)}function en(e){return typeof e=="function"}function Te(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function cn(e){return Object.keys(e).length===0}function tn(e,...t){if(e==null){for(const l of t)l(void 0);return X}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function xe(e){let t;return tn(e,n=>t=n)(),t}function Xe(e,t,n){e.$$.on_destroy.push(tn(t,n))}const fn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function u(e,t){e.appendChild(t)}function R(e,t,n){e.insertBefore(t,n||null)}function L(e){e.parentNode&&e.parentNode.removeChild(e)}function dn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function _(e){return document.createElement(e)}function $(e){return document.createTextNode(e)}function I(){return $(" ")}function bt(){return $("")}function D(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function f(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ot(e){return e===""?null:+e}function pn(e){return Array.from(e.childNodes)}function Z(e,t){t=""+t,e.data!==t&&(e.data=t)}function J(e,t){e.value=t??""}function et(e,t,n){for(let l=0;l<e.options.length;l+=1){const i=e.options[l];if(i.__value===t){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function qt(e){const t=e.querySelector(":checked");return t&&t.__value}function _n(e,t,{bubbles:n=!1,cancelable:l=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:l})}let Ue;function Be(e){Ue=e}function nn(){if(!Ue)throw new Error("Function called outside component initialization");return Ue}function gt(e){nn().$$.on_mount.push(e)}function ln(){const e=nn();return(t,n,{cancelable:l=!1}={})=>{const i=e.$$.callbacks[t];if(i){const s=_n(t,n,{cancelable:l});return i.slice().forEach(r=>{r.call(e,s)}),!s.defaultPrevented}return!0}}const Ne=[],nt=[];let Ie=[];const _t=[],hn=Promise.resolve();let ht=!1;function mn(){ht||(ht=!0,hn.then(sn))}function Ye(e){Ie.push(e)}function bn(e){_t.push(e)}const pt=new Set;let Ee=0;function sn(){if(Ee!==0)return;const e=Ue;do{try{for(;Ee<Ne.length;){const t=Ne[Ee];Ee++,Be(t),gn(t.$$)}}catch(t){throw Ne.length=0,Ee=0,t}for(Be(null),Ne.length=0,Ee=0;nt.length;)nt.pop()();for(let t=0;t<Ie.length;t+=1){const n=Ie[t];pt.has(n)||(pt.add(n),n())}Ie.length=0}while(Ne.length);for(;_t.length;)_t.pop()();ht=!1,pt.clear(),Be(e)}function gn(e){if(e.fragment!==null){e.update(),W(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ye)}}function vn(e){const t=[],n=[];Ie.forEach(l=>e.indexOf(l)===-1?t.push(l):n.push(l)),n.forEach(l=>l()),Ie=t}const tt=new Set;let ue;function rt(){ue={r:0,c:[],p:ue}}function ut(){ue.r||W(ue.c),ue=ue.p}function z(e,t){e&&e.i&&(tt.delete(e),e.i(t))}function K(e,t,n,l){if(e&&e.o){if(tt.has(e))return;tt.add(e),ue.c.push(()=>{tt.delete(e),l&&(n&&e.d(1),l())}),e.o(t)}else l&&l()}function lt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function yn(e,t){K(e,1,1,()=>{t.delete(e.key)})}function kn(e,t,n,l,i,s,r,a,o,c,d,p){let h=e.length,g=s.length,S=h;const T={};for(;S--;)T[e[S].key]=S;const A=[],N=new Map,b=new Map,k=[];for(S=g;S--;){const m=p(i,s,S),O=n(m);let F=r.get(O);F?k.push(()=>F.p(m,t)):(F=c(O,m),F.c()),N.set(O,A[S]=F),O in T&&b.set(O,Math.abs(S-T[O]))}const v=new Set,w=new Set;function y(m){z(m,1),m.m(a,d),r.set(m.key,m),d=m.first,g--}for(;h&&g;){const m=A[g-1],O=e[h-1],F=m.key,M=O.key;m===O?(d=m.first,h--,g--):N.has(M)?!r.has(F)||v.has(F)?y(m):w.has(M)?h--:b.get(F)>b.get(M)?(w.add(F),y(m)):(v.add(M),h--):(o(O,r),h--)}for(;h--;){const m=e[h];N.has(m.key)||o(m,r)}for(;g;)y(A[g-1]);return W(k),A}function wn(e,t,n){const l=e.$$.props[t];l!==void 0&&(e.$$.bound[l]=n,n(e.$$.ctx[l]))}function at(e){e&&e.c()}function je(e,t,n){const{fragment:l,after_update:i}=e.$$;l&&l.m(t,n),Ye(()=>{const s=e.$$.on_mount.map(xt).filter(en);e.$$.on_destroy?e.$$.on_destroy.push(...s):W(s),e.$$.on_mount=[]}),i.forEach(Ye)}function He(e,t){const n=e.$$;n.fragment!==null&&(vn(n.after_update),W(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Sn(e,t){e.$$.dirty[0]===-1&&(Ne.push(e),mn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ve(e,t,n,l,i,s,r=null,a=[-1]){const o=Ue;Be(e);const c=e.$$={fragment:null,ctx:[],props:s,update:X,not_equal:i,bound:Vt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(o?o.$$.context:[])),callbacks:Vt(),dirty:a,skip_bound:!1,root:t.target||o.$$.root};r&&r(c.root);let d=!1;if(c.ctx=n?n(e,t.props||{},(p,h,...g)=>{const S=g.length?g[0]:h;return c.ctx&&i(c.ctx[p],c.ctx[p]=S)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](S),d&&Sn(e,p)),h}):[],c.update(),d=!0,W(c.before_update),c.fragment=l?l(c.ctx):!1,t.target){if(t.hydrate){const p=pn(t.target);c.fragment&&c.fragment.l(p),p.forEach(L)}else c.fragment&&c.fragment.c();t.intro&&z(e.$$.fragment),je(e,t.target,t.anchor),sn()}Be(o)}class qe{constructor(){dt(this,"$$");dt(this,"$$set")}$destroy(){He(this,1),this.$destroy=X}$on(t,n){if(!en(n))return X;const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(n),()=>{const i=l.indexOf(n);i!==-1&&l.splice(i,1)}}$set(t){this.$$set&&!cn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const On="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(On);const Ae=[];function Fe(e,t=X){let n;const l=new Set;function i(a){if(Te(e,a)&&(e=a,n)){const o=!Ae.length;for(const c of l)c[1](),Ae.push(c,e);if(o){for(let c=0;c<Ae.length;c+=2)Ae[c][0](Ae[c+1]);Ae.length=0}}}function s(a){i(a(e))}function r(a,o=X){const c=[a,o];return l.add(c),l.size===1&&(n=t(i,s)||X),a(e),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:r}}const $e=Fe(null),Je=Fe([]),mt=Fe(new Map),it=Fe(!0),st=Fe(5),V=Fe("");try{const e=sessionStorage.getItem("electraCreds");if(e)$e.set(JSON.parse(e));else{const t=localStorage.getItem("electraCreds");t&&$e.set(JSON.parse(t))}}catch{}const Me={listDevices:"/api/devices",deviceStatus:e=>`/api/status/${encodeURIComponent(e)}`,sendCommand:"/api/command",power:"/api/power",authStart:"/api/auth/start",authVerify:"/api/auth/verify"},Pe="electraCreds";function Cn(){try{const e=sessionStorage.getItem(Pe);if(e)return JSON.parse(e)}catch{}try{const e=localStorage.getItem(Pe);if(e)return JSON.parse(e)}catch{}return null}function En(e,t){An();const n=JSON.stringify(e);t?localStorage.setItem(Pe,n):sessionStorage.setItem(Pe,n)}function An(){try{sessionStorage.removeItem(Pe)}catch{}try{localStorage.removeItem(Pe)}catch{}}async function De(e,t={}){const n=Cn(),l={"Content-Type":"application/json",...t.headers||{}};e.startsWith("/api/")&&n&&(l["X-Electra-IMEI"]=n.imei,l["X-Electra-Token"]=n.token);const i=await fetch(e,{headers:l,cache:"no-cache",...t});if(!i.ok){const r=await i.text().catch(()=>"");throw new Error(`HTTP ${i.status}: ${r}`)}return(i.headers.get("content-type")||"").includes("application/json")?i.json():i.text()}async function Nn(e,t){const n=t?{phone:e,imei:t}:{phone:e};return De(Me.authStart,{method:"POST",body:JSON.stringify(n)})}async function In(e,t,n){return De(Me.authVerify,{method:"POST",body:JSON.stringify({imei:e,phone:t,code:n})})}async function $n(){return De(Me.listDevices)}async function on(e){return De(Me.deviceStatus(e))}async function Pn({ac_id:e,mode:t,fan:n,temperature:l,ac_stsrc:i,shabat:s,sleep:r,ifeel:a}){const o={ac_id:e};return t!=null&&(o.mode=t),n!=null&&(o.fan=n),l!=null&&(o.temperature=l),i!=null&&(o.ac_stsrc=i),s!=null&&(o.shabat=s),r!=null&&(o.sleep=r),a!=null&&(o.ifeel=a),De(Me.sendCommand,{method:"POST",body:JSON.stringify(o)})}async function Tn(e,t){return De(Me.power,{method:"POST",body:JSON.stringify({ac_id:e,on:t})})}function rn(e){var r,a;const t=(e==null?void 0:e.commandJson)||{},n=((r=t==null?void 0:t.OPER)==null?void 0:r.OPER)||{},l=((a=t==null?void 0:t.DIAG_L2)==null?void 0:a.DIAG_L2)||{};return{isOn:Object.prototype.hasOwnProperty.call(n,"TURN_ON_OFF")?n.TURN_ON_OFF!=="OFF":n.AC_MODE!=="STBY",mode:n.AC_MODE??"STBY",fan:n.FANSPD??"OFF",spt:n.SPT??null,current:Fn(l),raw:e}}function Fn(e){if(!e)return null;const t=["I_RAT","I_CALC_AT","I_RCT"];for(const n of t){const l=e[n];if(l!=null){const i=Number(l);if(!Number.isNaN(i)&&i>=-5&&i<=42)return i}}return null}function zt(e,t,n){const l=e.slice();return l[15]=t[n],l[16]=t,l[17]=n,l}function Gt(e){let t,n,l=e[17],i,s;const r=()=>e[9](t,l),a=()=>e[9](null,l);function o(...p){return e[10](e[17],...p)}function c(...p){return e[11](e[17],...p)}function d(...p){return e[12](e[17],...p)}return{c(){t=_("input"),f(t,"type","tel"),f(t,"inputmode","numeric"),f(t,"pattern","[0-9]*"),f(t,"maxlength","1"),f(t,"autocomplete","one-time-code"),f(t,"aria-label",n=`${e[2]} ${e[17]+1} of ${e[0]}`),t.disabled=e[1],f(t,"class","otp-cell svelte-i5r295")},m(p,h){R(p,t,h),r(),i||(s=[D(t,"input",o),D(t,"keydown",c),D(t,"paste",d)],i=!0)},p(p,h){e=p,h&5&&n!==(n=`${e[2]} ${e[17]+1} of ${e[0]}`)&&f(t,"aria-label",n),h&2&&(t.disabled=e[1]),l!==e[17]&&(a(),l=e[17],r())},d(p){p&&L(t),a(),i=!1,W(s)}}}function Mn(e){let t,n=lt(Array.from({length:e[0]})),l=[];for(let i=0;i<n.length;i+=1)l[i]=Gt(zt(e,n,i));return{c(){t=_("div");for(let i=0;i<l.length;i+=1)l[i].c();f(t,"role","group"),f(t,"aria-label","One-time code input"),f(t,"class","svelte-i5r295")},m(i,s){R(i,t,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(t,null)},p(i,[s]){if(s&127){n=lt(Array.from({length:i[0]}));let r;for(r=0;r<n.length;r+=1){const a=zt(i,n,r);l[r]?l[r].p(a,s):(l[r]=Gt(a),l[r].c(),l[r].m(t,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=n.length}},i:X,o:X,d(i){i&&L(t),dn(l,i)}}}function Kt(e){return(e||"").replace(/\D/g,"")}function Dn(e,t,n){let{length:l=4}=t,{disabled:i=!1}=t,{autoFocus:s=!0}=t,{ariaLabelPrefix:r="OTP digit"}=t,{value:a=""}=t;const o=ln();let c=[];function d(b){n(7,a=b.join("")),o("change",{value:a}),a.length===l&&o("complete",{value:a})}function p(b,k){var y;if(i)return;const v=b.target;v.value=Kt(v.value).slice(0,1);const w=Array.from({length:l},(m,O)=>{var F;return((F=c[O])==null?void 0:F.value)||""});d(w),v.value&&k<l-1&&((y=c[k+1])==null||y.focus())}function h(b,k){var w,y,m;if(i)return;const v=b.key;v==="Backspace"&&!c[k].value&&k>0&&((w=c[k-1])==null||w.focus()),v==="ArrowLeft"&&k>0&&((y=c[k-1])==null||y.focus()),v==="ArrowRight"&&k<l-1&&((m=c[k+1])==null||m.focus())}function g(b){var y;if(i)return;const k=(b.clipboardData||window.clipboardData).getData("text"),v=Kt(k).slice(0,l).split("");if(!v.length)return;b.preventDefault();for(let m=0;m<l;m++)c[m]&&n(3,c[m].value=v[m]||"",c);d(v);const w=Math.min(v.length-1,l-1);(y=c[w])==null||y.focus()}gt(()=>{s&&c[0]&&c[0].focus()});function S(b,k){nt[b?"unshift":"push"](()=>{c[k]=b,n(3,c)})}const T=(b,k)=>p(k,b),A=(b,k)=>h(k,b),N=(b,k)=>b===0&&g(k);return e.$$set=b=>{"length"in b&&n(0,l=b.length),"disabled"in b&&n(1,i=b.disabled),"autoFocus"in b&&n(8,s=b.autoFocus),"ariaLabelPrefix"in b&&n(2,r=b.ariaLabelPrefix),"value"in b&&n(7,a=b.value)},[l,i,r,c,p,h,g,a,s,S,T,A,N]}class Ln extends qe{constructor(t){super(),Ve(this,t,Dn,Mn,Te,{length:0,disabled:1,autoFocus:8,ariaLabelPrefix:2,value:7})}}function Rn(e){let t,n,l,i,s,r,a,o,c,d,p,h,g,S,T,A,N,b,k,v,w,y,m,O,F,M,q,x,te;function Le(E){e[13](E)}let ne={length:4,disabled:e[7]};e[1]!==void 0&&(ne.value=e[1]),o=new Ln({props:ne}),nt.push(()=>wn(o,"value",Le)),o.$on("complete",e[9]);function Re(E,B){return E[5]?Bn:Xn}let Q=Re(e),j=Q(e);return{c(){t=_("div"),n=_("p"),l=$("Enter the 4-digit code sent to "),i=_("strong"),s=$(e[0]),r=I(),a=_("div"),at(o.$$.fragment),d=I(),p=_("div"),h=_("label"),g=_("input"),S=$(" Remember me"),T=I(),A=_("div"),N=_("button"),b=$("Verify"),v=I(),w=_("button"),j.c(),O=I(),F=_("div"),M=_("button"),M.textContent="Edit phone",f(n,"class","muted"),f(a,"class","otp-grid"),f(a,"aria-label","One-time code"),f(g,"type","checkbox"),f(h,"class","remember"),f(p,"class","auth-row"),f(N,"class","btn primary"),N.disabled=k=e[7]||e[1].length!==4,f(w,"class","btn secondary"),w.disabled=y=!!e[4],f(w,"aria-disabled",m=!!e[4]),f(A,"class","auth-actions"),f(M,"class","linklike"),f(M,"type","button"),f(F,"class","auth-links"),f(t,"class","auth-step")},m(E,B){R(E,t,B),u(t,n),u(n,l),u(n,i),u(i,s),u(t,r),u(t,a),je(o,a,null),u(t,d),u(t,p),u(p,h),u(h,g),g.checked=e[2],u(h,S),u(t,T),u(t,A),u(A,N),u(N,b),u(A,v),u(A,w),j.m(w,null),u(t,O),u(t,F),u(F,M),q=!0,x||(te=[D(g,"change",e[14]),D(N,"click",e[9]),D(w,"click",e[15]),D(M,"click",e[10])],x=!0)},p(E,B){(!q||B&1)&&Z(s,E[0]);const le={};B&128&&(le.disabled=E[7]),!c&&B&2&&(c=!0,le.value=E[1],bn(()=>c=!1)),o.$set(le),B&4&&(g.checked=E[2]),(!q||B&130&&k!==(k=E[7]||E[1].length!==4))&&(N.disabled=k),Q===(Q=Re(E))&&j?j.p(E,B):(j.d(1),j=Q(E),j&&(j.c(),j.m(w,null))),(!q||B&16&&y!==(y=!!E[4]))&&(w.disabled=y),(!q||B&16&&m!==(m=!!E[4]))&&f(w,"aria-disabled",m)},i(E){q||(z(o.$$.fragment,E),q=!0)},o(E){K(o.$$.fragment,E),q=!1},d(E){E&&L(t),He(o),j.d(),x=!1,W(te)}}}function Jn(e){let t,n,l,i,s,r,a,o,c;return{c(){t=_("div"),n=_("label"),l=$(`Phone
        `),i=_("input"),s=I(),r=_("button"),a=$("Send code"),f(i,"type","tel"),f(i,"placeholder","05XXXXXXXX"),f(i,"inputmode","tel"),f(i,"autocomplete","tel"),f(i,"aria-label","Phone number"),f(r,"class","btn primary"),r.disabled=e[6],f(t,"class","auth-step")},m(d,p){R(d,t,p),u(t,n),u(n,l),u(n,i),J(i,e[0]),u(t,s),u(t,r),u(r,a),o||(c=[D(i,"input",e[11]),D(r,"click",e[12])],o=!0)},p(d,p){p&1&&J(i,d[0]),p&64&&(r.disabled=d[6])},i:X,o:X,d(d){d&&L(t),o=!1,W(c)}}}function Xn(e){let t;return{c(){t=$("Resend")},m(n,l){R(n,t,l)},p:X,d(n){n&&L(t)}}}function Bn(e){let t,n,l;return{c(){t=$("You can resend in "),n=$(e[5]),l=$("s")},m(i,s){R(i,t,s),R(i,n,s),R(i,l,s)},p(i,s){s&32&&Z(n,i[5])},d(i){i&&(L(t),L(n),L(l))}}}function Un(e){let t,n,l,i,s,r;const a=[Jn,Rn],o=[];function c(d,p){return d[3]==="phone"?0:1}return i=c(e),s=o[i]=a[i](e),{c(){t=_("div"),n=_("h2"),n.textContent="Sign in",l=I(),s.c(),f(t,"class","auth-panel")},m(d,p){R(d,t,p),u(t,n),u(t,l),o[i].m(t,null),r=!0},p(d,[p]){let h=i;i=c(d),i===h?o[i].p(d,p):(rt(),K(o[h],1,1,()=>{o[h]=null}),ut(),s=o[i],s?s.p(d,p):(s=o[i]=a[i](d),s.c()),z(s,1),s.m(t,null))},i(d){r||(z(s),r=!0)},o(d){K(s),r=!1},d(d){d&&L(t),o[i].d()}}}let Yn=30;function Wt(e){return(e||"").trim()}function jn(e,t,n){const l=ln();let i="",s="",r="",a=!1,o="phone",c=null,d=0;function p(){h(),n(5,d=Yn),n(4,c=setInterval(()=>{n(5,d-=1),d<=0&&h()},1e3))}function h(){c&&clearInterval(c),n(4,c=null),n(5,d=0)}let g=!1,S=!1;async function T(m=!1){const O=Wt(i);if(!O){V.set("Enter phone number");return}n(6,g=!0);try{const M=await Nn(O,m&&s?s:void 0);if(s=(M==null?void 0:M.imei)||"",!s)throw new Error("No IMEI returned");V.set("Code sent"),n(1,r=""),n(3,o="code"),p()}catch(F){V.set(`Send failed: ${F.message}`)}finally{n(6,g=!1)}}async function A(){const m=(r||"").replace(/\D/g,"");if(!i||!s||m.length!==4){V.set("Enter the 4-digit code");return}n(7,S=!0);try{const O=await In(s,Wt(i),m);if(!(O!=null&&O.token))throw new Error("No token returned");En({imei:s,token:O.token},!!a),$e.set({imei:s,token:O.token}),V.set("Signed in"),l("signedin")}catch(O){V.set(`Verify failed: ${O.message}`)}finally{n(7,S=!1)}}function N(){s="",n(1,r=""),n(3,o="phone")}function b(){i=this.value,n(0,i)}const k=()=>T(!1);function v(m){r=m,n(1,r)}function w(){a=this.checked,n(2,a)}return[i,r,a,o,c,d,g,S,T,A,N,b,k,v,w,()=>T(!0)]}class Hn extends qe{constructor(t){super(),Ve(this,t,jn,Un,Te,{})}}function Vn(e){var Lt,Rt,Jt,Xt;let t,n,l,i,s,r,a=e[5]?e[5].isOn?"ON":"OFF":"—",o,c,d,p,h,g,S,T=(((Lt=e[5])==null?void 0:Lt.mode)??"—")+"",A,N,b,k,v,w,y=(((Rt=e[5])==null?void 0:Rt.fan)??"—")+"",m,O,F,M,q,x,te=(((Jt=e[5])==null?void 0:Jt.spt)??"—")+"",Le,ne,Re,Q,j,E,B=(((Xt=e[5])==null?void 0:Xt.current)??"—")+"",le,ze,vt,U,ae,yt,Ge,kt,Y,ce,fe,de,pe,_e,he,me,Ke,wt,be,St,We,Ot,H,ge,ve,ye,ke,we,Qe,Ct,ee,Se,Et,G,At,Oe,Nt,ie,Ze=e[4]?"Applying…":"Apply",ct,It,se,$t,Pt,Ce,oe,Tt,Ft,re,Mt,ft,Dt;return{c(){var C;t=_("div"),n=_("div"),l=_("div"),i=$(e[6]),s=I(),r=_("div"),o=$(a),d=I(),p=_("div"),h=_("div"),g=_("span"),g.textContent="Mode",S=_("span"),A=$(T),b=I(),k=_("div"),v=_("span"),v.textContent="Fan",w=_("span"),m=$(y),F=I(),M=_("div"),q=_("span"),q.textContent="Setpoint",x=_("span"),Le=$(te),Re=I(),Q=_("div"),j=_("span"),j.textContent="Current",E=_("span"),le=$(B),vt=I(),U=_("div"),ae=_("label"),yt=$("Mode"),kt=I(),Y=_("select"),ce=_("option"),ce.textContent="Mode…",fe=_("option"),fe.textContent="STBY (Standby)",de=_("option"),de.textContent="COOL",pe=_("option"),pe.textContent="FAN",_e=_("option"),_e.textContent="DRY",he=_("option"),he.textContent="HEAT",me=_("option"),me.textContent="AUTO",wt=I(),be=_("label"),St=$("Fan speed"),Ot=I(),H=_("select"),ge=_("option"),ge.textContent="Fan…",ve=_("option"),ve.textContent="LOW",ye=_("option"),ye.textContent="MED",ke=_("option"),ke.textContent="HIGH",we=_("option"),we.textContent="AUTO",Ct=I(),ee=_("div"),Se=_("button"),Se.textContent="−",Et=I(),G=_("input"),At=I(),Oe=_("button"),Oe.textContent="+",Nt=I(),ie=_("button"),ct=$(Ze),It=I(),se=_("button"),$t=$("Refresh"),Pt=I(),Ce=_("div"),oe=_("button"),Tt=$("Power On"),Ft=I(),re=_("button"),Mt=$("Power Off"),f(l,"class","title"),f(r,"class",c="badge "+((C=e[5])!=null&&C.isOn?"on":"off")),f(n,"class","header"),f(g,"class","k"),f(S,"id",N=`mode-${e[0]}`),f(h,"class","kv"),f(v,"class","k"),f(w,"id",O=`fan-${e[0]}`),f(k,"class","kv"),f(q,"class","k"),f(x,"id",ne=`spt-${e[0]}`),f(M,"class","kv"),f(j,"class","k"),f(E,"id",ze=`cur-${e[0]}`),f(Q,"class","kv"),f(p,"class","grid"),f(ae,"class","visually-hidden"),f(ae,"for",Ge=`modeSel-${e[0]}`),ce.__value="",J(ce,ce.__value),fe.__value="STBY",J(fe,fe.__value),de.__value="COOL",J(de,de.__value),pe.__value="FAN",J(pe,pe.__value),_e.__value="DRY",J(_e,_e.__value),he.__value="HEAT",J(he,he.__value),me.__value="AUTO",J(me,me.__value),f(Y,"id",Ke=`modeSel-${e[0]}`),f(Y,"aria-label","Mode"),e[1]===void 0&&Ye(()=>e[12].call(Y)),f(be,"class","visually-hidden"),f(be,"for",We=`fanSel-${e[0]}`),ge.__value="",J(ge,ge.__value),ve.__value="LOW",J(ve,ve.__value),ye.__value="MED",J(ye,ye.__value),ke.__value="HIGH",J(ke,ke.__value),we.__value="AUTO",J(we,we.__value),f(H,"id",Qe=`fanSel-${e[0]}`),f(H,"aria-label","Fan speed"),e[2]===void 0&&Ye(()=>e[13].call(H)),f(Se,"class","btn"),f(Se,"aria-label","Decrease setpoint"),f(G,"type","number"),f(G,"min","10"),f(G,"max","35"),f(G,"step","1"),f(G,"placeholder","Temp °C"),f(G,"aria-label","Setpoint temperature in Celsius"),f(Oe,"class","btn"),f(Oe,"aria-label","Increase setpoint"),f(ee,"class","tempctl"),f(ie,"class","btn primary"),ie.disabled=e[4],f(se,"class","btn secondary"),se.disabled=e[4],f(U,"class","controls"),f(oe,"class","btn"),oe.disabled=e[4],f(re,"class","btn"),re.disabled=e[4],f(Ce,"class","actions"),f(t,"class","card"),f(t,"data-id",e[0])},m(C,P){R(C,t,P),u(t,n),u(n,l),u(l,i),u(n,s),u(n,r),u(r,o),u(t,d),u(t,p),u(p,h),u(h,g),u(h,S),u(S,A),u(p,b),u(p,k),u(k,v),u(k,w),u(w,m),u(p,F),u(p,M),u(M,q),u(M,x),u(x,Le),u(p,Re),u(p,Q),u(Q,j),u(Q,E),u(E,le),u(t,vt),u(t,U),u(U,ae),u(ae,yt),u(U,kt),u(U,Y),u(Y,ce),u(Y,fe),u(Y,de),u(Y,pe),u(Y,_e),u(Y,he),u(Y,me),et(Y,e[1],!0),u(U,wt),u(U,be),u(be,St),u(U,Ot),u(U,H),u(H,ge),u(H,ve),u(H,ye),u(H,ke),u(H,we),et(H,e[2],!0),u(U,Ct),u(U,ee),u(ee,Se),u(ee,Et),u(ee,G),J(G,e[3]),u(ee,At),u(ee,Oe),u(U,Nt),u(U,ie),u(ie,ct),u(U,It),u(U,se),u(se,$t),u(t,Pt),u(t,Ce),u(Ce,oe),u(oe,Tt),u(Ce,Ft),u(Ce,re),u(re,Mt),ft||(Dt=[D(Y,"change",e[12]),D(H,"change",e[13]),D(Se,"click",e[14]),D(G,"input",e[15]),D(Oe,"click",e[16]),D(ie,"click",e[8]),D(se,"click",e[7]),D(oe,"click",e[17]),D(re,"click",e[18])],ft=!0)},p(C,[P]){var Bt,Ut,Yt,jt,Ht;P&64&&Z(i,C[6]),P&32&&a!==(a=C[5]?C[5].isOn?"ON":"OFF":"—")&&Z(o,a),P&32&&c!==(c="badge "+((Bt=C[5])!=null&&Bt.isOn?"on":"off"))&&f(r,"class",c),P&32&&T!==(T=(((Ut=C[5])==null?void 0:Ut.mode)??"—")+"")&&Z(A,T),P&1&&N!==(N=`mode-${C[0]}`)&&f(S,"id",N),P&32&&y!==(y=(((Yt=C[5])==null?void 0:Yt.fan)??"—")+"")&&Z(m,y),P&1&&O!==(O=`fan-${C[0]}`)&&f(w,"id",O),P&32&&te!==(te=(((jt=C[5])==null?void 0:jt.spt)??"—")+"")&&Z(Le,te),P&1&&ne!==(ne=`spt-${C[0]}`)&&f(x,"id",ne),P&32&&B!==(B=(((Ht=C[5])==null?void 0:Ht.current)??"—")+"")&&Z(le,B),P&1&&ze!==(ze=`cur-${C[0]}`)&&f(E,"id",ze),P&1&&Ge!==(Ge=`modeSel-${C[0]}`)&&f(ae,"for",Ge),P&1&&Ke!==(Ke=`modeSel-${C[0]}`)&&f(Y,"id",Ke),P&2&&et(Y,C[1]),P&1&&We!==(We=`fanSel-${C[0]}`)&&f(be,"for",We),P&1&&Qe!==(Qe=`fanSel-${C[0]}`)&&f(H,"id",Qe),P&4&&et(H,C[2]),P&8&&ot(G.value)!==C[3]&&J(G,C[3]),P&16&&Ze!==(Ze=C[4]?"Applying…":"Apply")&&Z(ct,Ze),P&16&&(ie.disabled=C[4]),P&16&&(se.disabled=C[4]),P&16&&(oe.disabled=C[4]),P&16&&(re.disabled=C[4]),P&1&&f(t,"data-id",C[0])},i:X,o:X,d(C){C&&L(t),ft=!1,W(Dt)}}}function qn(e,t,n){let l,i,s,r;Xe(e,mt,y=>n(11,r=y));let{d:a}=t;async function o(){try{const y=await on(l),m=rn(y);mt.update(O=>new Map(O.set(String(l),m)))}catch(y){V.set(`Status error for ${l}: ${y.message}`)}}let c="",d="",p="",h=!1;async function g(){const y={ac_id:l};if(c&&(y.mode=c),d&&(y.fan=d),p&&(y.temperature=Number(p)),!y.mode&&!y.fan&&y.temperature===void 0){V.set("Nothing to apply");return}try{n(4,h=!0),await Pn(y),V.set(`Applied to ${l}`),await o()}catch(m){V.set(`Apply error for ${l}: ${m.message}`)}finally{n(4,h=!1)}}async function S(y){try{n(4,h=!0),await Tn(l,y),V.set(`Power ${y?"On":"Off"} sent to ${l}`),await o()}catch(m){V.set(`Power toggle error for ${l}: ${m.message}`)}finally{n(4,h=!1)}}function T(){c=qt(this),n(1,c)}function A(){d=qt(this),n(2,d)}const N=()=>n(3,p=String(Math.max(10,Number(p||24)-1)));function b(){p=ot(this.value),n(3,p)}const k=()=>n(3,p=String(Math.min(35,Number(p||24)+1))),v=()=>S(!0),w=()=>S(!1);return e.$$set=y=>{"d"in y&&n(10,a=y.d)},e.$$.update=()=>{e.$$.dirty&1024&&n(0,l=((a==null?void 0:a.id)??(a==null?void 0:a.imei)??(a==null?void 0:a.device_id)??(a==null?void 0:a.name)??"unknown").toString()),e.$$.dirty&1025&&n(6,i=a!=null&&a.name?`${a.name} — ${l}`:`Device ${l}`),e.$$.dirty&2049&&n(5,s=r.get(l))},[l,c,d,p,h,s,i,o,g,S,a,r,T,A,N,b,k,v,w]}class zn extends qe{constructor(t){super(),Ve(this,t,qn,Vn,Te,{d:10})}}const{Map:Gn}=fn;function Qt(e,t,n){const l=e.slice();return l[7]=t[n],l}function Kn(e){let t=[],n=new Gn,l,i,s=lt(e[0]);const r=a=>a[7].id;for(let a=0;a<s.length;a+=1){let o=Qt(e,s,a),c=r(o);n.set(c,t[a]=Zt(c,o))}return{c(){for(let a=0;a<t.length;a+=1)t[a].c();l=bt()},m(a,o){for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(a,o);R(a,l,o),i=!0},p(a,o){o&1&&(s=lt(a[0]),rt(),t=kn(t,o,r,1,a,s,n,l.parentNode,yn,Zt,l,Qt),ut())},i(a){if(!i){for(let o=0;o<s.length;o+=1)z(t[o]);i=!0}},o(a){for(let o=0;o<t.length;o+=1)K(t[o]);i=!1},d(a){a&&L(l);for(let o=0;o<t.length;o+=1)t[o].d(a)}}}function Wn(e){let t;return{c(){t=_("div"),t.textContent="No devices found.",f(t,"class","empty")},m(n,l){R(n,t,l)},p:X,i:X,o:X,d(n){n&&L(t)}}}function Zt(e,t){let n,l,i;return l=new zn({props:{d:t[7]}}),{key:e,first:null,c(){n=bt(),at(l.$$.fragment),this.first=n},m(s,r){R(s,n,r),je(l,s,r),i=!0},p(s,r){t=s;const a={};r&1&&(a.d=t[7]),l.$set(a)},i(s){i||(z(l.$$.fragment,s),i=!0)},o(s){K(l.$$.fragment,s),i=!1},d(s){s&&L(n),He(l,s)}}}function Qn(e){let t,n,l,i;const s=[Wn,Kn],r=[];function a(o,c){return o[0].length===0?0:1}return n=a(e),l=r[n]=s[n](e),{c(){t=_("div"),l.c(),f(t,"class","cards")},m(o,c){R(o,t,c),r[n].m(t,null),i=!0},p(o,[c]){let d=n;n=a(o),n===d?r[n].p(o,c):(rt(),K(r[d],1,1,()=>{r[d]=null}),ut(),l=r[n],l?l.p(o,c):(l=r[n]=s[n](o),l.c()),z(l,1),l.m(t,null))},i(o){i||(z(l),i=!0)},o(o){K(l),i=!1},d(o){o&&L(t),r[n].d()}}}function Zn(e,t,n){let l;Xe(e,Je,d=>n(0,l=d));let i=null;function s(d){V.set(d||"")}async function r(){if(!xe($e)){s("Sign in to view devices"),Je.set([]);return}s("Loading devices…");try{const p=await $n(),h=Array.isArray(p)?p:p.devices||[];Je.set(h),await Promise.all(h.map(g=>a(g.id))),s("")}catch(p){s(`Failed to load devices: ${p.message}`)}}async function a(d){try{const p=await on(d),h=rn(p);mt.update(g=>new Map(g.set(String(d),h)))}catch(p){s(`Status error for ${d}: ${p.message}`)}}function o(){c();const d=Math.max(1,Number(xe(st))||5);xe(it)&&(i=setInterval(()=>{(xe(Je)||[]).forEach(h=>a(h.id))},d*1e3))}function c(){i&&clearInterval(i),i=null}return gt(()=>{const d=()=>r();window.addEventListener("reload-devices",d);const p=it.subscribe(o),h=st.subscribe(o),g=$e.subscribe(T=>{T?r():(c(),Je.set([]))});r();const S=()=>{document.hidden?c():o()};return document.addEventListener("visibilitychange",S),()=>{window.removeEventListener("reload-devices",d),document.removeEventListener("visibilitychange",S),p(),h(),g(),c()}}),[l]}class xn extends qe{constructor(t){super(),Ve(this,t,Zn,Qn,Te,{})}}function el(e){let t,n,l,i,s,r,a,o,c,d,p,h,g,S,T,A,N,b,k;return A=new xn({}),{c(){t=_("div"),n=_("button"),n.textContent="Refresh All",l=I(),i=_("label"),s=_("input"),r=$(" Auto-refresh"),a=I(),o=_("label"),c=$(`every
      `),d=_("input"),p=$(`
      sec`),h=I(),g=_("span"),S=$(e[3]),T=I(),at(A.$$.fragment),f(s,"type","checkbox"),f(s,"aria-label","Toggle auto refresh"),f(d,"type","number"),f(d,"min","5"),f(d,"max","300"),f(d,"step","5"),f(d,"aria-label","Auto refresh interval in seconds"),f(g,"class","status"),f(g,"role","status"),f(g,"aria-live","polite"),f(t,"class","toolbar")},m(v,w){R(v,t,w),u(t,n),u(t,l),u(t,i),u(i,s),s.checked=e[1],u(i,r),u(t,a),u(t,o),u(o,c),u(o,d),J(d,e[2]),u(o,p),u(t,h),u(t,g),u(g,S),R(v,T,w),je(A,v,w),N=!0,b||(k=[D(n,"click",e[4]),D(s,"change",e[5]),D(d,"input",e[6])],b=!0)},p(v,w){w&2&&(s.checked=v[1]),w&4&&ot(d.value)!==v[2]&&J(d,v[2]),(!N||w&8)&&Z(S,v[3])},i(v){N||(z(A.$$.fragment,v),N=!0)},o(v){K(A.$$.fragment,v),N=!1},d(v){v&&(L(t),L(T)),He(A,v),b=!1,W(k)}}}function tl(e){let t,n;return t=new Hn({}),{c(){at(t.$$.fragment)},m(l,i){je(t,l,i),n=!0},p:X,i(l){n||(z(t.$$.fragment,l),n=!0)},o(l){K(t.$$.fragment,l),n=!1},d(l){He(t,l)}}}function nl(e){let t,n,l,i,s,r;const a=[tl,el],o=[];function c(d,p){return d[0]?1:0}return l=c(e),i=o[l]=a[l](e),{c(){t=_("h1"),t.textContent="Electra Control",n=I(),i.c(),s=bt()},m(d,p){R(d,t,p),R(d,n,p),o[l].m(d,p),R(d,s,p),r=!0},p(d,[p]){let h=l;l=c(d),l===h?o[l].p(d,p):(rt(),K(o[h],1,1,()=>{o[h]=null}),ut(),i=o[l],i?i.p(d,p):(i=o[l]=a[l](d),i.c()),z(i,1),i.m(s.parentNode,s))},i(d){r||(z(i),r=!0)},o(d){K(i),r=!1},d(d){d&&(L(t),L(n),L(s)),o[l].d(d)}}}function ll(e,t,n){let l,i,s;Xe(e,it,p=>n(1,l=p)),Xe(e,st,p=>n(2,i=p)),Xe(e,V,p=>n(3,s=p));let r=!1;const a=$e.subscribe(p=>{n(0,r=!!p)});gt(()=>()=>a());const o=()=>window.dispatchEvent(new CustomEvent("reload-devices"));function c(){l=this.checked,it.set(l)}function d(){i=ot(this.value),st.set(i)}return[r,l,i,s,o,c,d]}class il extends qe{constructor(t){super(),Ve(this,t,ll,nl,Te,{})}}new il({target:document.getElementById("app")});
